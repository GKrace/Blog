# Http协议

HTTP协议（Hyper Text Transfer Protocol），超文本传输协议，是用于从万维网服务器传输超文本到本地浏览器的传输协议。HTTP是基于TCP/IP协议通信协议来传递数据（html文件，图片文件，查询结果等），它不涉及数据包（packet）传输，主要规定了客户端和服务器之间的通信格式，默认使用80端口  
常见的协议有http,https,ftp,file

## 一.Http特点

1.**简单快速**:客户向服务器请求服务时，只需传送请求方法和路径，请求方法最常用的有GET，HEAD，POST，PUT，DELETE.每种方法规定了客户与服务器联系的类型不同，由于HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快。  
2.**灵活**:HTTP允许传输任意类型的数据对象。  
3.**无连接**:无连接的含义是限制每次链接只处理一个请求，服务器处理完客户的请求，并收到客户的应答后，即断开连接，采用这种方式可以节省传输时间  
4.**无状态**:HTTP协议是无状态的，HTTP协议自身不对请求和响应之间的通信状态进行保存，任何两次请求之间都没有依赖关系。直观的说，就是每个请求都是独立的。与前面的请求和后面的请求都是没有直接联系的。协议本身并不保留之前一切的请求或响应报文的信息，**这是为了更快的处理大量事务，确保协议的可伸缩性，而特意把HTTP协议设计成如此简单的**

## 二.Http报文

### 1.请求行，用来说明请求类型，要访问的资源以及所使用的HTTP版本

>POST /user/user.html HTTP/1.1

### 2.请求头由关键字/值对组成，每行一对，关键字和值用英文冒号":"分隔

请求头部通知服务器有关客户端请求的信息，它包含许多有关的客户端环境和请求正文的有用信息 。比如：  
**Host:主机名，虚拟主机**  
**Connection：HTTP/1.1增加的，使用keepalice，即持久链接，一个链接可以发多个请求**  
**User-Agent：请求发出者，兼容性及定制化需求**

### 3.最后一个请求头之后是一个空行，这个行非常重要，它表示请求头已经结束，接下来的是请求正文

### 4.请求体，可以承载多个请求参数的数据

> name=zhangsan&age=18

## 三.HTTP请求方法

* GET 发送一个请求来取得服务器上的某一资源
* POST 向URL指定的资源提交数据或附加新的数据
* PUT 根POST方法很像，也是想服务器提交数据。但是，他们之间有不同。PUT指定了资源在服务器上的位置，而POST没有
* HEAD 只请求页面的头部
* DELETE 删除服务器上的某资源
* OPTIONS 它用于获取当前URL所支持的方法，如果请求成功，会有一个Allow的头包含类似“GET，POST”这样的信息
* TRACE 用于激发一个远程的，应用层的请求消息回路
* CONNECT 把请求链接转换到透明的TCP/IP通道

## 四.GET和POST区别

* GET在浏览器回退时是无害的，而POST会再次提交请求
* GET请求会被浏览器主动缓存，而POST不会，除非手动设置
* GET请求参数会被完整保留在浏览器历史记录，而POST中的参数不会被保留
* GET请求在URL中传送的参数是有长度限制的，而POST没有限制
* GET参数通过URL传递，POST放在Request body中

## 五.Http状态码

* 1xx 表示成功接受请求，要求客户端继续提交下一次请求才能完成整个处理过程
* 2xx 表述成功接受请求并已完成整个处理过程
* 3xx 为完成请求，客户需进一步细化需求，例如：请求的资源已经移动到一个新地址，常用302（重定向），307 304（拿缓存）
* 4xx 客户端的请求有错误，包含语法错误和不能正确执行，常用404（请求的资源在web服务器中没有） 403（服务器拒绝访问，权限不够）
* 5xx 服务器端出现错误

### 常用状态码

* 200 正常 表示一切正常，返回的是正常请求结果
* 302/307 临时重定向，指出请求的文档已被临时移动到别处，此文档的新的url在location响应头中给出
* 304 未修改 表示客户端缓存的版本是最新的，客户端应该继续使用它
* 400 请求语法错误
* 401 未授权 登录失败
* 402 为将来可能的需求而预留的
* 403 禁止 服务器理解客户端请求，但拒绝处理它，通常用于服务器上文件或目录的权限设置所致
* 404 找不到
* 500 服务器内部错误

## 六.持久链接

### 1.为什么需要持久链接

**HTTP协议的初始版本中，每进行一次HTTP通信就要断开一次TCP链接。**以前由于传输文本很小，所以这样没有太大问题，随着普及，请求HTML页面资源的同时，也请求文档中包含大量图片和其他资源，因此，**每次的请求都会造成无谓的TCP链接建立和断开，增加通信量的开销**

### 2.持久链接的特点

为解决伤处TCP链接的问题，HTTP/1.1和一部分的HTTP/1.0想出了持久链接（HTTP Persistent Connections 也称为HTTP keep-alive或HTTP connection reuse）的方法，持久链接的特点是：**只要任意一端没有明确提出断开连接，则保持TCP链接状态**  
**持久链接的好处在于减少了TCP链接的重复建立和断开所造成的额外开销，减轻了服务器端的负载，另外，减少开销的那部分时间，使HTTP请求和响应能够跟早的结束，这样web页面的显示速度也就相应提高了**  
在HTTP/1.1中，所有的链接默认都是持久链接，但在HTTP/1.0内并未标准化

## 七.管线化

持久链接使得多数请求以管线化（pipelining）的方式发送成为可能，以前发送请求后需要等待并接受响应，才能发送一个请求，管线化技术出现以后，不用等待响应就可直接发送下一个请求  
**这样就能做到同时并发多个请求，而不需要一个一个等待响应了，通俗地讲，请求打包一次传输过去，响应打包一次传递回来，管线化的前提是持久链接下**  

### 管线化和持久化对比

例如当一个包含10张图的HTML Web页面，**与挨个链接相比，用持久链接可以让请求更快结束。而管线化技术则比持久链接还要更快。**请求数越多，时间差就越明显。客户端需要请求这十个资源。  
以前的做法是在同一个TCP链接里面，发送A请求，然后等待服务器做出回应，收到后再发出B请求，以此类推，  
而管道机制则是允许浏览器同时发出这是个请求，但服务器还是按照顺序，先回应A请求，完成后再回应B请求  

* 持久链接： 请求1->响应1->请求2->响应2->请求3->响应3
* 管线化： 请求1->请求2->请求3->响应1->响应2->响应3
