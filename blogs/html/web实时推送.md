# 实时推送

## 一.双向通信

### 1.轮询（polling）

轮询是客户端和服务器之间会一直进行连接，每隔一段时间就询问一次。

* 优点：实现简单，无需做过多的更改
* 缺点：轮询的时间间隔过长，会导致用户不能及时接收到更新的数据;轮询的间隔过短，会导致查询请求过多，增加服务端的负担

### 2.长轮询（long-polling）

长轮询是对轮询的的改进版 ，客户端发送HTTP给服务器之后，看有没有新消息，如果没有新消息，就一直等待，当有新消息的时候，才返回给客户端。在某种程度上减少了网络宽带和CPU利用率等问题，由于http数据包的头部数量往往很大（通常400多字节），但真正被服务器需要的数据却很少(有时只有10字节左右)，这样的数据包在网络上周期性的传输，**难免对网络宽带是一种浪费**。

* 优点：比Polling做了优化，有较好的时效性
* 缺点：保持连接会消耗资源，服务器没有返回有效数据，程序超时。

### 3.iframe流（streaming）

iframe流方式是在页面中插入一个隐藏的iframe，利用src属性在服务器和客户端之间创建一条长链接，服务器像iframe传输数据（通常是HTML，内有负责插入信息的javascript），来实现更新页面

* 优点： 消息能够实时到达，浏览器兼容好
* 缺点： 服务器维护一个长链接会增加开销，IE，chrome，firefox辉县市没有加载完成，图标会不停旋转。

## 二.WebSocket

* 支持双向通信，实时性更强
* 可以发送文本，也可以发送二进制数据
* 减少通信量：只要建立起websocket连接，就希望一直保持连接状态。和HTTP相比，不但每次连接时的总开销减少，而且由于WebSocket的首部信息很小，通信量也相应减少了

缺点：浏览器支持程度不一致，不支持断开重连  

| 方式 | 类型 | 技术实现 | 优点 | 缺点 | 使用场景 |
| — | — | - | — | - | — |  
| 轮询Polling | client->server | 客户端循环请求 | 1.实现简单2.支持跨域 | 1.浪费宽带和服务器资源2.一次请求信息大半是无用(完整http头信息)3.有延迟4.大部分无效请求 | 使用小型应用 |  
| 长轮询Long-Polling | client->server | 服务器hold住连接，一直到有数据或者超时才返回，减少重复请求次数 | 1.实现简单2.不会频繁发请求3.节省流量4.延迟低 | 1.服务器hold住连接，会消耗资源2.一次性请求信息大半是无用的 | webQQ，Hi网页，Facebook IM |  
| 长链接iframe | client->server | 在页面内嵌入一个隐藏iframe，将这个iframe的src属性设为对一个长链接的请求，服务器就能源源不断地往客户端输入数据 | 1.数据实时送达2.不发无用请求，一次链接，多次推送| 1.服务器增加开销2.无法准确直到连接状态3.IE，chrome等一直会处于loading状态 | Gmail聊天 |  
| WebSocket || server -- client | new WebSocket() | 1.支持双向通信，实时性更强2.可发送二进制文件3.减少通信量 | 1.浏览器支持程度不一致2.不支持断开重连 | 网络游戏，银行交互和支付 |
